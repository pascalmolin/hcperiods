\documentclass[main.tex]{subfiles}

\begin{document}

  \section{Intersections}\label{sec:intersections}

   Let $(a,b)$ and $(c,d)$ be two edges of the spanning tree $E$.
  The formulas in Theorem \ref{m-thm:intsec_numb} allow to compute the intersection
  between lifts of elementary cycles $\left(\cyab^{(k)} \circ \cycd^{(l)}\right)$.

  Note that by construction of the spanning tree,
  we can restrict the analysis to intersections $\left(\cyab^{(k)} \circ \cycd^{(l)}\right)$ 
  such that $c$ is either $a$ or $b$.

   \begin{thm}[Intersection numbers]\label{thm:intsec_numb}
      Let $(a,b),(c,d) \in E$. The intersections of the corresponding cycles $\cyabk, \cycdl \in \Gamma$ are given by
      \begin{equation*}
          \left(\cyab^{(k)} \circ \cycd^{(l)}\right)
          = \begin{cases}
              1  &\text{ if } l-k \equiv s_+ \bmod m,\\
              -1 &\text{ if } l-k \equiv s_- \bmod m,\\
              0 &\text{ otherwise,}
          \end{cases}
      \end{equation*}
      where $s_+$, $s_-$ are given by the following table, which covers all
      cases occurring in the algorithm
      \begin{center}
          \normalfont
      \begin{tabular}{cccc}
          \toprule
          & Case & $s_+$ & $s_-$ \\
          \midrule
         (i) & $a=c$ and $b=d$ & $1$ & $-1$ \\
         (ii) & $b=c$ & $-s_b$ & $1-s_b$ \\
         (iii) & $a=c$ and $\rho>0$ & $1-s_a$ & $-s_a$ \\
         (iv) & $a=c$ and $\rho<0$ & $-s_a$ & $-1-s_a$\\
         (v) & $\set{a,b}\cap\set{c,d}=\varnothing$ & \multicolumn{2}{c}{no intersection} \\
          \bottomrule
      \end{tabular}
      \end{center}
      and where $s_x \in \Z$ for $x\in\set{a,b}$ is given by
      \begin{equation*}\label{eq:s_x}
	    s_x := \frac{1}{2\pi}\left( \rho + m \cdot \arg \left( \frac{C_{c,d} \ytcd(x)}{C_{a,b}\ytab(x)} \right) 
	    \right)
      \end{equation*}
     and
      \begin{equation*}
          \rho = \arg \left( \frac{b-a}{d-c} \right) + \delta_{b=c}\pi.
      \end{equation*}
 \end{thm}

 \begin{rmk}
     Notice that the intersection matrix $K_{\Gamma}$ is composed of
  $(n-1)^2$ blocks of dimension $m-1$, each block corresponding to the intersection
  of shifts of two elementary cycles in the spanning tree. It is very sparse.
  %In particular,
  %\begin{equation*}
  % K_{\Gamma} = \left( K_{i,j} \right)_{1\le i,j \le n-1}
  %\end{equation*}
  %where $i,j$ correspond to edges $e_i,e_j$ in the spanning tree $T = (X,E)$ and
  %\begin{equation*}
  %  K_{i,j} = \left(\gamma_{e_i}^{(k)} \circ \gamma_{e_j}^{(l)} \right)_{0 \le k,l < m-1}.
  %\end{equation*}
 \end{rmk}


 \bigskip
 The proof of Theorem \ref{m-thm:intsec_numb}is contained in the following exposition.
 \bigskip

  Consider
  two cycles $\cyab^{(k)},\cycd^{(l)} \in \Gamma$ and
  recall from \S \ref{m-subsec:roots_branches} their definition 
   \begin{align*}
      \cyabk & = \{  (x,\zeta^k \yab(x))  \mid  x \in [a,b]  \} \cup \{  (x,\zeta^{k+1} \yab(x))  \mid  x \in [b,a]  \}, \\
      \cycdl & = \{  (x,\zeta^l \ycd(x))  \mid  x \in [c,d]  \} \cup \{  (x,\zeta^{l+1} \ycd(x))  \mid  x \in [c,d]  \},
   \end{align*}
  where $\zeta^k\yab(x),\zeta^l\ycd(x)$ are branches of $\cu$ that are analytic on open sets $\vab$ and $\vcd$ 
  (see Figure \ref{m-fig:set_vab}) respectively.

  \begin{proof}\let\qed\relax (of case (v)) \\
  From the definition we see that $\cyabk \cap \cycdl = \varnothing$, whenever $[a,b] \cap [c,d] = \varnothing$. For edges in a spanning tree
  this is equivalent to $\{a,b\} \cap \{c,d\} = \varnothing$, thus
  proving (v).
  \end{proof}

   Henceforth, we can assume $\{a,b\} \cap \{c,d\} \ne \varnothing$. In order to prove (i)-(iv) we have to introduce some machinery. Since the $\yab(x),\ycd(x)$ are branches of $\cu$,
   on the set $\C \setminus X$
   we can define the \emph{shifting function}
   $s(x)$, that takes values in $\Z/m\Z$, implicitly via
  \begin{equation}\label{eq:shift_func}
   \zeta^{s(x)} = \frac{\ycd(x)}{\yab(x)}.
   \end{equation}
  Naturally, \eqref{eq:shift_func} extends to the other analytic branches via
  \begin{equation*}
   \zeta^{s(x)+l-k} = \frac{\zeta^l\ycd(x)}{\zeta^k\yab(x)}.
   \end{equation*}
   We can now define the non-empty, open, disconnected set
   \begin{equation*}
    V := \vab \cap \vcd \subset \C \setminus X.
   \end{equation*}
 The shifting function $s(x)$ is well-defined on $V$ and, since $\yab(x)$ and $\ycd(x)$ are 
  both analytic on $V$, $s(x)$ is constant on its 
  connected components.
  
  In \S \ref{m-subsec:riemann_surface} we established that multiplication of a branch by $\zeta$ corresponds to moving
  one sheet up on the Riemann surface.
  We can interpret the value of the shifting function geometrically as
  $\cycdl$ running $s(\xt)+l-k$ sheets above $\cyabk$ at a point $\xt \in V$.
  
 This can be used to determine the intersection number in the following way. We deform the cycles homotopically
 such that
 \begin{equation*}
   \pr\left(\cyabk\right) \cap \pr\left(\cycdl\right) = \{ \xt \}  \text{ for some $\xt \in V$.} 
 \end{equation*}
 Consequently, the cycles can at most intersect at the
 points in the fiber above $\xt$, i.e.
 \begin{equation*}
  \cyab^{(k)} \cap \cycd^{(l)} \subset \pr^{-1}(\xt).
 \end{equation*}
 Notice that, by definition, any cycle in $\Gamma$ only runs on two neighbouring sheets, which already implies
 \begin{equation*}
   \left(\cyab^{(k)} \circ \cycd^{(l)}\right) = 0, \text{ if $s(\xt)+l-k \not\in \{-1,0,1\}$.}
 \end{equation*}
  In the other cases we can determine the
  sign of possible intersections by taking into account the orientation of the cycles.
  
 We continue the proof with the next simplest case:
 \begin{proof}\let\qed\relax (of case (i)) \\
 Here we have $[a,b] = [c,d]$. Trivially, $\left( \cyabk \circ \cyabk \right) = 0$ holds. For $k \ne l$ we deform the cycles such that they only intersect above
 $\xt = \frac{b+a}{2} \in  \vab= V$.
  We easily see that $s(\xt) = 0$ and therefore $s(\xt) + l - k = l - k$. The remaining non-trivial cases
 ($l = k \pm 1$), are shown in Figure \ref{m-fig:int_self_shift} below.
   Illustrated are the cycles $\cyabk$ (black),
      $\cyab^{(k+1)}$ (red) and $\cyab^{(k-1)}$ (green).
    \begin{figure}[H]
      \begin{center}
   \scalebox{0.8}{\input{images/intsec_selfshift.tex}}
      \end{center}
    \caption{Intersections of self-shifts.}
    \label{fig:int_self_shift}
\end{figure}
  We see that, independently of $s(\xt)$, $s_+ = (k+1)-k = 1$ and $s_- = (k-1)-k = -1$ are as claimed.
 \end{proof}

  For (ii)-(iv) we have that $[a,b] \cap [c,d] = \{c \}$, where $c$ is either $a$ or $b$. Unfortunately, in these cases $s(c)$ is not
  well-defined.
  
 Instead, we choose a point $\xt \in \C \setminus X$ on the bisectrix of
  $[a,b]$ and $[c,d]$ that is close enough to $c$ such that $[\xt,c[ \subset V = \vab \cap \vcd$
  (see Figure \ref{m-fig:set_v_both} below), and where
  \begin{equation}\label{eq:sxt}
   s(\xt) = \frac{m}{2\pi} \arg \left( \frac{\ycd(\xt)}{\yab(\xt)} \right).
  \end{equation}
    \begin{figure}[H]
      \begin{center}
   \scalebox{.9}{\input{images/set_v_both.tex}}
      \end{center}
     \vspace{-1cm}
    \caption{The set $V = \vab \cap \vcd$ for $b=c$ (left) and $a=c$ (right).}
    \label{fig:set_v_both}
   \end{figure}
   
   \begin{proof}\let\qed\relax (of case (ii)) \\
   In this case we have $b = c$. Choosing $\xt$ on the upper bisectrix (as shown in Figure \ref{m-fig:set_v_both}) 
   and computing $s(\xt)$ with \eqref{m-eq:sxt} makes it possible to determine the intersection numbers geometrically.
   
   Figure \ref{m-fig:int_b=c} shows the non-trivial cases $s(\xt) + l - k \in \{-1,0,1\}$.
   Illustrated are the cycles $\cyab^k$ (black), $\cybd^{k-s(\xt)}$ (gray), $\cybd^{k-s(\xt) + 1 }$ (green) and
    $\cybd^{k-s(\xt)-1}$ (red).
    \begin{figure}[H]
      \begin{center}
   \scalebox{0.8}{\input{images/intsec_b=c.tex}}
      \end{center}
    \caption{Intersections for $b=c$.}
    \label{fig:int_b=c}
   \end{figure}
    By Lemma \ref{lemma:sxt=sx} (1) we have $s(\xt) \equiv s_b$, which implies (as claimed)
    \begin{align*}
    & s_+ \equiv k-s(\xt)-k \equiv -s_b \mod m, \\
    & s_- \equiv k-s(\xt)+1-k \equiv 1-s_b \mod m.
    \end{align*}
   \end{proof}
 
 \begin{proof}(of cases (iii) and  (iv))
 In these cases we have $a = c$. We choose $\xt$ on the inner bisectrix (as shown in Figure \ref{m-fig:set_v_both}) and 
   and compute $s(\xt)$ with \eqref{m-eq:sxt}. 
 
 For $\varphi = \arg\left(\frac{b-a}{d-c}\right) > 0$, the non trivial cases, i.e. $s(\xt) + l - k \in \{-1,0,1\}$, are shown in Figure \ref{m-fig:int_a=c} 
  We illustrate are the cycles $\cyab^{(k)}$ (black), $\cyad^{(k-s(\xt))}$ (gray), $\cyad^{(k-s(\xt) + 1)}$ (green) and
    $\cyad^{k-s(\xt)-1}$ (red).
  \begin{figure}[H]
      \begin{center}
   \scalebox{0.8}{\input{images/intsec_a=c.tex}}
      \end{center}
    \caption{Intersections for $a=c$ and $\varphi > 0$.}
    \label{fig:int_a=c}
   \end{figure}
   Lemma \ref{lemma:sxt=sx} (2) gives us $s(\xt) \equiv s_a$, which implies (as claimed for $\varphi > 0$)
    \begin{align*}
    & s_+ = k-s(\xt)+1-k \equiv 1-s_a \mod m, \\
    & s_- = k-s(\xt)-k \equiv -s_a \mod m.
    \end{align*}
  The case $\varphi < 0$ is easily derived as a symmetry: if we mirror Figure \ref{m-fig:int_a=c} at the horizontal line through $a$ we are in case (iv).
  There, the intersection is positive if $\cyabk$ and $\cyadl$ start on the same sheet and negative if $\cyadl$ starts one sheet below $\cyabk$. 
  \end{proof}
  
\begin{lemma}\label{lemma:sxt=sx}
  With the choices made in the proof of Theorem \ref{m-thm:intsec_numb} the following statements are true:
  \begin{itemize}
   \item[(1)] $s(\xt) \equiv s_b \bmod m$ in case {\upshape{(ii)}},
    \item[(2)]  $s(\xt) \equiv s_a \bmod m$ in the cases {\upshape{(iii)}} and {\upshape{(iv)}}.
  \end{itemize}
\end{lemma}
 \begin{proof}
 Starting from equation \eqref{m-eq:sxt}, for all $x \in \C \setminus X$ we have
   \begin{align*}
   s(x) & = \frac{m}{2\pi} \arg \left( \frac{\ycd(x)}{\yab(x)} \right)
   \equiv \frac{m}{2\pi} \left( \arg \left( \frac{(1- \ucd(x)^2)\mr}{(1-\uab(x)^2)\mr} \right) + \arg \left( \frac{ \ccd \ytcd(x)}{\cab
   \ytab(x)} \right) \right) \\
   & \equiv \frac{1}{2\pi} \left( \arg(1+\ucd(x)) + \arg(1-\ucd(x)) - \arg(1+\uab(x)) - \arg(1-\uab(x)) \right) \\
   & +  \frac{m}{2\pi} \left( \arg \left( \frac{ \ccd \ytcd(x)}{\cab\ytab(x)} \right)\right) \mod m.
  \end{align*}
 In case (ii) we have $b = c$ and denote $\varphi_0 = \arg \left( \frac{b-a}{d-c} \right)$. Then, we can parametrize all points $\xt \ne b$ on 
 the upper bisectrix of $[a,b]$ and
 $[a,d]$ (see Figure \ref{m-fig:set_v_both}) via
 \begin{align*}
  \xt & = \xbd(-1+t \exp(i(\pi+\varphi_0)/2)) \text{  as well as} \\
  \xt & = \xab(1-t \exp(-i (\pi+\varphi_0)/2))
 \end{align*}
 for some $t > 0$. Therefore,
 \begin{align*}
   & \arg (1+\ubd(\xt)) = \frac{\pi+\varphi_0}{2} \text{ and} \\
   & \arg (1-\uab(\xt)) = -\frac{\pi+\varphi_0}{2}.
 \end{align*}
 For $\xt$ chosen close enough to $b$ we have that $[\xt,b[ \subset V$ and the shifting function $s(\xt)$ is constant as $\xt$ tends towards $b$. Hence, 
 we can compute its value at $\xt$ as
 \begin{align*}
  s(\xt) & \equiv \frac{1}{2\pi} \left( \pi + \varphi_0 + \arg(1-\ubd(\xt)) - \arg(1+\uab(\xt)) +  m \arg \left( \frac{ \cbd \ytcd(\xt)}{\cab\ytab(\xt)} \right)\right) \\
	 & \equiv \frac{1}{2\pi} \left ( \varphi +\arg(1-\ubd(b)) - \arg(1+\uab(b)) +  m \arg \left( \frac{ \cbd \ytbd(b)}{\cab\ytab(b)} \right)\right) \\
	 & \equiv \frac{1}{2\pi} \left( \varphi +\arg(2) - \arg(2) +  m \arg \left( \frac{ \ccd \ytbd(b)}{\cab\ytab(b)} \right)\right) \equiv s_b \mod m,
 \end{align*}
thus proving (1).

  In the cases (iii) and (iv) we have $a = c$ and denote $\varphi =  \arg \left( \frac{b-a}{d-c} \right)$. For $\varphi > 0$ we can parametrize all points $\xt \ne a$ on the inner
  bisectrix of $[a,b]$ and $[a,d]$ (see Figure \ref{m-fig:set_v_both}) via
 \begin{align*}
  \xt & = \xad(-1+t \exp(i \varphi /2)) \text{  as well as} \\
  \xt & = \xab(-1+t \exp(-i \varphi/2))
 \end{align*}
 for some $t > 0$. Therefore,
 \begin{align*}
   & \arg (1+\uad(\xt)) = \frac{\varphi}{2} \text{ and} \\
   & \arg (1+\uab(\xt)) = -\frac{\varphi}{2}.
 \end{align*}
 As before, we let $\xt$ tend towards $a$ and compute the shifting function at $\xt$ as
 \begin{align*}
  s(\xt) & \equiv \frac{1}{2\pi} \left( \varphi + \arg(1-\uad(\xt)) - \arg(1+\uab(\xt)) +  m \arg \left( \frac{ \cad \ytad(\xt)}{\cab\ytab(\xt)} \right)\right) \\
	 & \equiv \frac{1}{2\pi} \left ( \varphi +\arg(1-\uad(a)) - \arg(1-\uab(a)) +  m \arg \left( \frac{ \cad \ytad(a)}{\cab\ytab(a)} \right)\right) \\
	 & \equiv \frac{1}{2\pi} \left( \varphi +\arg(2) - \arg(2) +  m \arg \left( \frac{ \ccd \ytad(a)}{\cab\ytab(a)} \right)\right) \equiv s_a \mod m.
 \end{align*}
 The case $\varphi < 0$ is proved analogously.
\end{proof} 

\begin{rmk}
  The intersection numbers given by Theorem \ref{m-thm:intsec_numb} are independent of the choices of $\xt$ that were made in the proof. This approach works for any $\xt \in V$.
  
  Even though the value of
  $s(\xt)$ changes, if we choose $\xt$ in a different connected component of $V$, e.g.\ on the lower bisectrix in case (ii),  
  the parametrization of the bisectrix and the corresponding arguments will change accordingly.
\end{rmk}

\end{document}
